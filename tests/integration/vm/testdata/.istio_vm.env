#!/bin/bash
# shellcheck disable=all

# .....................................................
# Generic options
# .....................................................

#
# Runtime options
PAUSE_ON_FAILURE=${PAUSE_ON_FAILURE:-false}
EXIT_ON_FAILURE=${EXIT_ON_FAILURE:-false}

#
# Platform options .........
PLATFORM=${PLATFORM:-docker}
CLEANUP=${CLEANUP:-false}
ISTIODIR=${ISTIODIR:-}
declare -a SUPPORTED_PLATFORMS=("gcp" "docker")
TARGET_ARCH=${TARGET_ARCH:-amd64}

#
# VM app options .........
VM_APP="vm-svc"
VM_NAMESPACE=cloud
VM_SERVICE_ACCOUNT=vmtest
VM_PROXY=${VM_PROXY:-ztunnel}

#
# SPIRE options ..........
SPIRE_AGENT_CONFIG=${SPIRE_AGENT_CONFIG:-}
SPIRE_SERVER_CONFIG=${SPIRE_SERVER_CONFIG:-}

#
# Istio options .........
CLUSTER_NETWORK=""
VM_NETWORK=""
CLUSTER="Kubernetes"
PROFILE=${PROFILE:-ambient}
INSTALL_ISTIO=${INSTALL_ISTIO:-true}
DNS_CAPTURE=${DNS_CAPTURE:-true}
REVISION=${REVISION:-}
ISTIOCTL=${ISTIOCTL:-istioctl}
HUB=${HUB:-localhost:5000}
TAG=${TAG:-setme} # make sure this is already built locally

#
# Test app options .......
HTTPBIN_URL="http://httpbin.test.svc:8000"
VM_SVC_URL="http://vmsvc.cloud.svc:9000"


# .....................................................
# Docker options
# .....................................................

DOCKER_WORK_DIR=/tmp/vm
declare -a DOCKER_VM_LIST=("vm1")
DOCKER_SPIRE_SERVER=spire-server

# .....................................................
# GCP options
# .....................................................
declare -a GCP_VM_LIST=("shashank-z1" "shashank-z2")
GCP_VM_ZONE=us-east1-d
GCP_SPIRE_SERVER_NAME=shashank-spire
GCP_SPIRE_SERVER_ZONE=us-east1-d


# .....................................................
# Test expectations
# .....................................................
if [ "${VM_PROXY}" = "envoy" ]; then
    L4_RBAC_RESP_CODE=403
else
    L4_RBAC_RESP_CODE=000
fi
